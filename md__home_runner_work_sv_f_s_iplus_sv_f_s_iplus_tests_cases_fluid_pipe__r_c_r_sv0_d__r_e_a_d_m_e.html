<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>svFSIplus: &lt;strong&gt;Problem Description&lt;/strong&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">svFSIplus
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title"><b>Problem Description</b> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Solve the same problem as in <a href="../pipe_RCR_3D">fluid/pipe_RCR_3d</a>. Instead of using the RCR within the <code>svFSIplus</code> solver, this example demonstrates how to set up RCR boundary condition in a more generalized framework using sv0DSolver.</p>
<h1><a class="anchor" id="autotoc_md122"></a>
Introduction</h1>
<p>Both sv0DSolver and genBC (see <a href="../pipe_RCR_genBC">pipe_RCR_genBC</a>) provide a framework to programmatically define custom inflow and outflow boundary conditions for a CFD simulation. The framework allows users to create an arbitrary lumped parameter network (LPN, or 0D model) layout suitable for their application. Some common examples include a lumped parameter heart model that models contraction of the heart chambers to use as an inlet boundary condition, sophisticated models of the downstream circulation for various areas of the body such as the legs and upper body, or a closed-loop formulation where all outflow of the SimVascular model returns back to the inflow after passing through the veins, heart, and pulmonary arteries.</p>
<p><b>Essentially, sv0D and genBC are two different implementations of the same functionality, and sv0D is the preferred choice.</b> genBC is a legacy code developed for <a href="https://github.com/SimVascular/svSolver">svSolver</a> and requires direct input of a system of equations. sv0DSolver has pre-defined blocks with associated equations and is more user-friendly. Still, <code>svFSIplus</code> provides backward compatibility for genBC so that svSolver users can migrate to the new solver easily.</p>
<h2><a class="anchor" id="autotoc_md123"></a>
Build svZeroDSolver</h2>
<p>Importantly, to automatically run test cases with <code>pytest</code> (see below), you need to build <code>svZeroDSolver</code> in the folder </p><div class="fragment"><div class="line">./svZeroDSolver/build</div>
</div><!-- fragment --><p> in the repository root.</p>
<p>To do so, you can run the following in the svFSIplus repository root: </p><div class="fragment"><div class="line">git clone https://github.com/SimVascular/svZeroDSolver.git</div>
<div class="line">cd svZeroDSolver</div>
<div class="line">mkdir build</div>
<div class="line">cd build</div>
<div class="line">cmake ..</div>
<div class="line">make -j2</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md124"></a>
Configuration of sv0DSolver</h1>
<p>The following files require user's attention: <a href="./svFSI.xml">svFSI.xml</a>, <a href="./svzerod_3Dcoupling.json">svzerod_3Dcoupling.json</a> and <a href="./svZeroD_interface.dat">svZeroD_interface.dat</a>.</p>
<h2><a class="anchor" id="autotoc_md125"></a>
svFSI.xml</h2>
<p>The input file <a href="./svFSI.xml">svFSI_genBC.xml</a> follows the master input file as a template. Some specific input options are discussed below:</p>
<div class="fragment"><div class="line">&lt;Couple_to_svZeroD type=&quot;SI&quot;&gt;</div>
<div class="line">&lt;/Couple_to_svZeroD&gt;</div>
</div><!-- fragment --><p>This tells the solver that the 0d models will be calculated through sv0DSolver. Options to couple 0D codes with svFSI are <code>N</code>: none; <code>I</code>: implicit; <code>SI</code>: semi-implicit; <code>E</code>: explicit.</p>
<div class="fragment"><div class="line">&lt;Add_BC name=&quot;lumen_inlet&quot; &gt; </div>
<div class="line">   &lt;Type&gt; Dir &lt;/Type&gt; </div>
<div class="line">   &lt;Time_dependence&gt; Unsteady &lt;/Time_dependence&gt; </div>
<div class="line">   &lt;Temporal_values_file_path&gt; lumen_inlet.flw&lt;/Temporal_values_file_path&gt; </div>
<div class="line">   &lt;Zero_out_perimeter&gt; true &lt;/Zero_out_perimeter&gt; </div>
<div class="line">   &lt;Impose_flux&gt; true &lt;/Impose_flux&gt; </div>
<div class="line">&lt;/Add_BC&gt; </div>
<div class="line"> </div>
<div class="line">&lt;Add_BC name=&quot;lumen_outlet&quot; &gt; </div>
<div class="line">   &lt;Type&gt; Neu &lt;/Type&gt; </div>
<div class="line">   &lt;Time_dependence&gt; Coupled &lt;/Time_dependence&gt; </div>
<div class="line">&lt;/Add_BC&gt; </div>
</div><!-- fragment --><p>In this example, we use the LPN for just the outlet RCR boundary condition and use a file to specify the inlet flow conditions.</p>
<h2><a class="anchor" id="autotoc_md126"></a>
svzerod_3Dcoupling.json</h2>
<p>This is the configuration file for sv0DSolver and contains the elements of the 0D model being coupled to the 3D simulation.</p>
<p>For more information on the available parameters and elements, documentation is available here: <a href="https://github.com/SimVascular/svZeroDSolver">svZeroDSolver</a></p>
<p><b>The following are necessary in "simulation_parameters" for a coupled simulation:</b> "coupled_simulation": true, "steady_initial": false</p>
<p>The external coupling block is what connects the 3D element to the 0D model. sv0D allows you to create a name for this element and specify its type (in this case, we are interested in <b>flow</b> out of the pipe). It is connected at the <b>inlet</b> of the block with the name <b>RCR</b>. Values of <b>time</b> (t) are set to the beginning and end of a cardiac cycle (0.0 to 1.0 s) and the corresponding <b>flow values</b> (Q) are set to 1.0, as this flow will be received from the 3D simulation.</p>
<p>The RCR boundary condition block sets up the RCR element with the desired resistance and pressure values.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    &quot;simulation_parameters&quot;: {</div>
<div class="line">        &quot;coupled_simulation&quot;: true,</div>
<div class="line">        &quot;number_of_time_pts&quot;: 100,</div>
<div class="line">        &quot;output_all_cycles&quot;: true,</div>
<div class="line">        &quot;steady_initial&quot;: false</div>
<div class="line">    },</div>
<div class="line">    &quot;boundary_conditions&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;bc_name&quot;: &quot;RCR&quot;,</div>
<div class="line">            &quot;bc_type&quot;: &quot;RCR&quot;,</div>
<div class="line">            &quot;bc_values&quot;: {</div>
<div class="line">                &quot;Rp&quot;: 121.0,</div>
<div class="line">                &quot;Rd&quot;: 1212.0,</div>
<div class="line">                &quot;C&quot;: 1.5e-4,</div>
<div class="line">                &quot;Pd&quot;: 0.0</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    ],</div>
<div class="line">    &quot;external_solver_coupling_blocks&quot;: [</div>
<div class="line">        {</div>
<div class="line">            &quot;name&quot;: &quot;RCR_coupling&quot;,</div>
<div class="line">            &quot;type&quot;: &quot;FLOW&quot;,</div>
<div class="line">            &quot;location&quot;: &quot;inlet&quot;,</div>
<div class="line">            &quot;connected_block&quot;: &quot;RCR&quot;,</div>
<div class="line">            &quot;periodic&quot;: false,</div>
<div class="line">            &quot;values&quot;: {</div>
<div class="line">                &quot;t&quot;: [0.0, 1.0],</div>
<div class="line">                &quot;Q&quot;: [1.0, 1.0]</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    ],</div>
<div class="line">    &quot;junctions&quot;: [],</div>
<div class="line">    &quot;vessels&quot;: []</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md127"></a>
svZeroD_interface.dat</h2>
<p>This file sets up the interface between svFSIplus and sv0DSolver. It requires the path of the dynamic library for svZeroDSolver and the input file (svzerod_3Dcoupling.json) discussed above.</p>
<p>This file also matches the external coupling blocks in the 0D model to the coupled surfaces in svFSIplus: The first element in each line should be the name of the block from the json file and the second element should be the index of the coupled surface in svFSIplus. In this case, there is only one coupled surface with index 0.</p>
<div class="fragment"><div class="line">svZeroD external coupling block names to surface IDs (where surface IDs are from *.svpre file):</div>
<div class="line">RCR_coupling 0</div>
</div><!-- fragment --><p>The next lines initialize the pressure and flow of these coupled surfaces in the 0D model: 0 indicates that the values will not be initialized, and 1 indicates that they will be initialized to the value provided afterwards.</p>
<div class="fragment"><div class="line">Initialize external coupling block flows:</div>
<div class="line">0</div>
<div class="line"> </div>
<div class="line">External coupling block initial flows (one number is provided, it is applied to all coupling blocks):</div>
<div class="line">0.0</div>
<div class="line"> </div>
<div class="line">Initialize external coupling block pressures:</div>
<div class="line">1</div>
<div class="line"> </div>
<div class="line">External coupling block initial pressures (one number is provided, it is applied to all coupling blocks):</div>
<div class="line">0.0</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
